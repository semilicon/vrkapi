<?php
	//add_wagon
	global $ASUVRK;
	if(!isset($_GET['IND']))die('{"success":false,"result":{"error":"wrongIND"}}');
	$IND=trim($_GET['IND']);
	$iVagon=$ASUVRK->GetVagonByIND($IND);
	$VagonComplekt=$iVagon->VagonComplekt();
	$IN=$VagonComplekt->IN;
	$OUT=$VagonComplekt->OUT;
	
	$KP_IN=array();
	for($i=0;$i<$IN->KP_Count;$i++){
		$detail=$IN->GetKP($i);
		$KP_IN[]=(object)array(
			'IND'=>(string)$detail->GlobalDetalId,
			'Zavod'=>$detail->Zavod,
			'Nomer'=>$detail->Nomer,
			'God'=>$detail->God,
			'Stal'=>$detail->Stal,
			'TypKP'=>$detail->TypKP,
			//'Ftype'=>$detail->Ftype,
		);
	}
	$KP_OUT=array();
	for($i=0;$i<$OUT->KP_Count;$i++){
		$detail=$OUT->GetKP($i);
		$KP_OUT[]=(object)array(
			'IND'=>(string)$detail->GlobalDetalId,
			'Zavod'=>$detail->Zavod,
			'Nomer'=>$detail->Nomer,
			'God'=>$detail->God,
			'Stal'=>$detail->Stal,
			'TypKP'=>$detail->TypKP,
			//'Ftype'=>$detail->Ftype,
		);
	}
	$AS_IN=array();
	for($i=0;$i<$IN->AS_Count;$i++){
		$detail=$IN->GetAS($i);
		$AS_IN[]=(object)array(
			'IND'=>(string)$detail->GlobalDetalId,
			'Zavod'=>$detail->Zavod,
			'Nomer'=>$detail->Nomer,
			'God'=>$detail->God,
			'Ftype'=>$detail->Ftype,
		);
	}
	$AS_OUT=array();
	for($i=0;$i<$OUT->AS_Count;$i++){
		$detail=$OUT->GetAS($i);
		$AS_OUT[]=(object)array(
			'IND'=>(string)$detail->GlobalDetalId,
			'Zavod'=>$detail->Zavod,
			'Nomer'=>$detail->Nomer,
			'God'=>$detail->God,
			'Ftype'=>$detail->Ftype,
		);
	}
	$PA_IN=array();
	for($i=0;$i<$IN->PA_Count;$i++){
		$detail=$IN->GetPA($i);
		$PA_IN[]=(object)array(
			'IND'=>(string)$detail->IND,
			'Zavod'=>$detail->Zavod,
			'Nomer'=>$detail->Nomer,
			'God'=>$detail->God,
			'Ftype'=>$detail->Ftype,
		);
	}
	$PA_OUT=array();
	for($i=0;$i<$OUT->PA_Count;$i++){
		$detail=$OUT->GetPA($i);
		$PA_OUT[]=(object)array(
			'IND'=>(string)$detail->IND,
			'Zavod'=>$detail->Zavod,
			'Nomer'=>$detail->Nomer,
			'God'=>$detail->God,
			'Ftype'=>$detail->Ftype,
		);
	}
	$TX_IN=array();
	for($i=0;$i<$IN->TX_Count;$i++){
		$detail=$IN->GetTX($i);
		$TX_IN[]=(object)array(
			'IND'=>(string)$detail->IND,
			'Zavod'=>$detail->Zavod,
			'Nomer'=>$detail->Nomer,
			'God'=>$detail->God,
			'Ftype'=>$detail->Ftype,
		);
	}
	$TX_OUT=array();
	for($i=0;$i<$OUT->TX_Count;$i++){
		$detail=$OUT->GetTX($i);
		$TX_OUT[]=(object)array(
			'IND'=>(string)$detail->IND,
			'Zavod'=>$detail->Zavod,
			'Nomer'=>$detail->Nomer,
			'God'=>$detail->God,
			'Ftype'=>$detail->Ftype,
		);
	}
	$NB_IN=array();
	for($i=0;$i<$IN->NB_Count;$i++){
		$detail=$IN->GetNB($i);
		$NB_IN[]=(object)array(
			'IND'=>(string)$detail->IND,
			'Zavod'=>$detail->Zavod,
			'Nomer'=>$detail->Nomer,
			'God'=>$detail->God,
		);
	}
	$NB_OUT=array();
	for($i=0;$i<$OUT->NB_Count;$i++){
		$detail=$OUT->GetNB($i);
		$NB_OUT[]=(object)array(
			'IND'=>(string)$detail->IND,
			'Zavod'=>$detail->Zavod,
			'Nomer'=>$detail->Nomer,
			'God'=>$detail->God,
		);
	}
	$BR_IN=array();
	for($i=0;$i<$IN->BR_Count;$i++){
		$detail=$IN->GetBR($i);
		$BR_IN[]=(object)array(
			'IND'=>(string)$detail->IND,
			'Zavod'=>$detail->Zavod,
			'Nomer'=>$detail->Nomer,
			'God'=>$detail->God,
		);
	}
	$BR_OUT=array();
	for($i=0;$i<$OUT->BR_Count;$i++){
		$detail=$OUT->GetBR($i);
		$BR_OUT[]=(object)array(
			'IND'=>(string)$detail->IND,
			'Zavod'=>$detail->Zavod,
			'Nomer'=>$detail->Nomer,
			'God'=>$detail->God,
		);
	}
	$DETAILS=(object)array(
		'IN'=>(object)array(
			'KP'=>$KP_IN,
			'AS'=>$AS_IN,
			'PA'=>$PA_IN,
			'TX'=>$TX_IN,
			'NB'=>$NB_IN,
			'BR'=>$BR_IN
		),
		'OUT'=>(object)array(
			'KP'=>$KP_OUT,
			'AS'=>$AS_OUT,
			'PA'=>$PA_OUT,
			'TX'=>$TX_OUT,
			'NB'=>$NB_OUT,
			'BR'=>$BR_OUT
		)
	);
	$return=(object)array(
		'success'=>true,
		'result'=>$DETAILS
	);
	echo json_encode($return);
?>